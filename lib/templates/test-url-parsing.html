<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPA URL 解析测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>SPA URL 解析测试</h2>
        
        <h3>当前URL解析结果：</h3>
        <div id="currentUrl" class="test-result"></div>
        
        <h3>测试不同的URL：</h3>
        <button onclick="testUrl('#error-detail')">测试: #error-detail</button>
        <button onclick="testUrl('#error-detail?id=error123')">测试: #error-detail?id=error123</button>
        <button onclick="testUrl('#file-detail')">测试: #file-detail</button>
        <button onclick="testUrl('#file-detail?path=/src/test.js')">测试: #file-detail?path=/src/test.js</button>
        
        <div id="testResults"></div>
    </div>

    <script>
        // 模拟SPA路由解析函数
        function parseRoute(hash) {
            if (!hash) hash = window.location.hash;
            
            const hashWithoutPrefix = hash.slice(1) || 'main';
            const [page, paramString] = hashWithoutPrefix.split('?');
            
            const params = {};
            if (paramString) {
                paramString.split('&').forEach(param => {
                    const [key, value] = param.split('=');
                    params[key] = decodeURIComponent(value);
                });
            }
            
            return { page, params };
        }
        
        // 模拟错误详情页面的URL参数获取
        function getErrorIdFromUrl() {
            try {
                const hash = window.location.hash;
                if (hash.includes('?')) {
                    const params = new URLSearchParams(hash.split('?')[1]);
                    return params.get('id');
                }
            } catch (error) {
                console.error('解析URL参数失败:', error);
            }
            return null;
        }
        
        // 模拟文件详情页面的URL参数获取
        function getFilePathFromUrl() {
            try {
                const hash = window.location.hash;
                if (hash.includes('?')) {
                    const params = new URLSearchParams(hash.split('?')[1]);
                    return params.get('path');
                }
            } catch (error) {
                console.error('解析URL参数失败:', error);
            }
            return null;
        }
        
        function updateCurrentUrl() {
            const result = parseRoute();
            const errorId = getErrorIdFromUrl();
            const filePath = getFilePathFromUrl();
            
            document.getElementById('currentUrl').innerHTML = `
                <strong>当前URL:</strong> ${window.location.hash || '(empty)'}<br>
                <strong>解析结果:</strong><br>
                - 页面: ${result.page}<br>
                - 参数: ${JSON.stringify(result.params)}<br>
                - 错误ID: ${errorId || 'null'}<br>
                - 文件路径: ${filePath || 'null'}
            `;
        }
        
        function testUrl(testHash) {
            const oldHash = window.location.hash;
            
            // 临时设置URL
            window.location.hash = testHash;
            
            const result = parseRoute();
            const errorId = getErrorIdFromUrl();
            const filePath = getFilePathFromUrl();
            
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = `
                <strong>测试URL:</strong> ${testHash}<br>
                <strong>解析结果:</strong><br>
                - 页面: ${result.page}<br>
                - 参数: ${JSON.stringify(result.params)}<br>
                - 错误ID: ${errorId || 'null'}<br>
                - 文件路径: ${filePath || 'null'}
            `;
            
            document.getElementById('testResults').appendChild(resultDiv);
            
            // 恢复原URL
            window.location.hash = oldHash;
            updateCurrentUrl();
        }
        
        // 监听hash变化
        window.addEventListener('hashchange', updateCurrentUrl);
        
        // 初始化
        updateCurrentUrl();
    </script>
</body>
</html>
